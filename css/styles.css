:root{
  --bg:#0b1f2d;
  --panel:#102b3a;
  --panel2:#123447;
  --text:#eaf6ff;
  --muted:#a8c1d3;
  --blue:#1a6ea5;
  --green:#1f7a4f;
  --gold:#f2c04c;
  --gold2:#ffd37a;
  --danger:#e04b4b;
  --ok:#29c56b;
  --shadow: 0 10px 28px rgba(0,0,0,.35);
  --radius:18px;
  --radius2:26px;
  --tap: 52px;
  --maxw: 520px;
}
*{box-sizing:border-box}
html,body{height:100%;background-color:#0b1f2d}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  background-color:#0b1f2d;
  background-image: radial-gradient(1200px 700px at 50% -20%, rgba(26,110,165,.35), transparent 55%),
              radial-gradient(800px 600px at 120% 40%, rgba(31,122,79,.25), transparent 55%),
              linear-gradient(180deg, #071723, #0b1f2d 40%, #071723);
  color:var(--text);
  overflow:hidden;
}

/* Layout */
.app{
  height:100%;
  display:flex;
  flex-direction:column;
}
.topbar{
  min-height:64px;
  padding:10px 14px;
  padding-top: calc(env(safe-area-inset-top, 0px) + 10px);
  padding-left: calc(env(safe-area-inset-left, 0px) + 14px);
  padding-right: calc(env(safe-area-inset-right, 0px) + 14px);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  background: linear-gradient(180deg, rgba(16,43,58,.95), rgba(16,43,58,.6));
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(255,255,255,.08);
  flex-shrink:0;
}
.brand{
  display:flex;
  gap:10px;
  align-items:center;
  min-width:0;
  flex-shrink:1;
  overflow:hidden;
}
.brand .logo{
  width:38px;height:38px;border-radius:12px;
  display:grid;place-items:center;
  background: linear-gradient(135deg, rgba(242,192,76,.25), rgba(26,110,165,.25));
  border:1px solid rgba(255,255,255,.12);
}
.brand h1{margin:0;font-size:16px;line-height:1.1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.brand .sub{margin:0;font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

.hud{display:flex;gap:8px;align-items:center;flex-shrink:0}
.pill{
  position:relative;
  height:40px;
  padding:0 12px;
  border-radius:999px;
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
  display:flex;gap:8px;align-items:center;
  font-weight:700;
  box-shadow: 0 8px 18px rgba(0,0,0,.18);
}
.pill small{font-weight:600;color:var(--muted)}
#hudRegen{
  position:absolute;
  bottom:-1px;
  left:50%;
  transform:translateX(-50%) translateY(60%);
  font-size:9px;
  font-weight:700;
  color:var(--gold);
  background:rgba(11,31,45,.95);
  padding:1px 6px;
  border-radius:8px;
  border:1px solid rgba(242,192,76,.25);
  white-space:nowrap;
  line-height:1.3;
  pointer-events:none;
  z-index:2;
}
#hudRegen:empty{display:none}
.pill .icon{font-size:16px}

.main{
  flex:1;
  display:flex;
  justify-content:center;
  overflow:hidden;
}
.viewport{
  width:100%;
  max-width: var(--maxw);
  padding:14px;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
}

.screen{
  display:none;
  flex-direction:column;
  gap:12px;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  padding-bottom:20px;
}
.screen.active{display:flex}

.card{
  background: linear-gradient(180deg, rgba(18,52,71,.95), rgba(16,43,58,.92));
  border:1px solid rgba(255,255,255,.10);
  border-radius: var(--radius2);
  box-shadow: var(--shadow);
  overflow:hidden;
}
.card.pad{padding:14px}

.titleRow{display:flex;align-items:center;justify-content:space-between;gap:10px}
.h2{margin:0;font-size:20px}
.p{margin:0;color:var(--muted);line-height:1.4}

.btnRow{display:flex;gap:10px;flex-wrap:wrap}
.btn{
  min-height: var(--tap);
  padding: 12px 14px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.12);
  color:var(--text);
  background: rgba(255,255,255,.06);
  font-weight:800;
  font-size:15px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
}
.btn:active{transform: translateY(1px) scale(.98)}
.btn.primary{
  background: linear-gradient(135deg, rgba(31,122,79,.95), rgba(26,110,165,.85));
  border-color: rgba(255,255,255,.14);
}
.btn.gold{
  background: linear-gradient(135deg, rgba(242,192,76,.95), rgba(255,211,122,.85));
  color:#1a1a1a;
  border-color: rgba(0,0,0,.15);
}
.btn.danger{background: rgba(224,75,75,.18); border-color: rgba(224,75,75,.35)}
.btn.ghost{background: transparent}
.btn.block{width:100%}

.grid{
  display:grid;
  grid-template-columns: 1fr;
  gap:12px;
}
@media(min-width:480px){
  .grid.two{grid-template-columns: 1fr 1fr}
}

.lesson{
  display:flex; gap:12px; align-items:stretch;
  padding:12px;
}
.lesson .badge{
  width:56px; height:56px;
  border-radius:18px;
  display:grid; place-items:center;
  background: rgba(242,192,76,.14);
  border:1px solid rgba(242,192,76,.25);
  font-size:24px;
}
.lesson .meta{flex:1}
.lesson .meta h3{margin:0;font-size:16px}
.lesson .meta p{margin:4px 0 0 0;color:var(--muted);font-size:13px}
.lesson .right{display:flex;flex-direction:column;align-items:flex-end;gap:6px;min-width:90px}
.lock{font-size:12px;color:rgba(255,255,255,.65)}

.progressBar{height:12px;border-radius:999px;background:rgba(255,255,255,.10);overflow:hidden;border:1px solid rgba(255,255,255,.08)}
.progressBar > div{height:100%;background: linear-gradient(90deg, rgba(31,122,79,.9), rgba(242,192,76,.9)); width:0%}

.stars{display:flex;gap:2px;font-size:14px}
.star{opacity:.35}
.star.on{opacity:1}

/* Learn/Quiz full-screen feel */
.stage{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.stageTop{display:flex;justify-content:space-between;align-items:center;gap:10px}
.stageTop > div:first-child{min-width:0;overflow:hidden}
.stageTop .tag{font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.stageTop .meter{flex:1;max-width:220px}

.fishCard{
  flex:1;
  display:flex;
  flex-direction:column;
}
.fishHero{
  background: radial-gradient(900px 400px at 50% 20%, rgba(242,192,76,.18), transparent 60%),
              radial-gradient(900px 400px at 10% 60%, rgba(31,122,79,.18), transparent 60%),
              rgba(0,0,0,.06);
  border-bottom:1px solid rgba(255,255,255,.08);
  padding:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  min-height: 210px;
}
.fishInfo{padding:12px 14px;display:flex;flex-direction:column;gap:8px}
.fishName{display:flex;align-items:baseline;justify-content:space-between;gap:10px}
.fishName h3{margin:0;font-size:18px}
.fishName .sci{color:var(--muted);font-size:12px;font-style:italic}

.callouts{display:flex;flex-wrap:wrap;gap:8px}
.chip{
  padding:8px 10px;
  border-radius: 999px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.06);
  font-size:12px;
  color: var(--text);
}
.chip.gold{background: rgba(242,192,76,.18); border-color: rgba(242,192,76,.25)}
.chip.green{background: rgba(31,122,79,.18); border-color: rgba(31,122,79,.28)}
.chip.blue{background: rgba(26,110,165,.18); border-color: rgba(26,110,165,.28)}

.list{margin:0;padding-left:18px;color:var(--text)}
.list li{margin:6px 0;color:rgba(234,246,255,.92)}

/* Quiz options */
.options{display:grid;grid-template-columns:1fr;gap:10px}
.opt{
  min-height: var(--tap);
  border-radius: 16px;
  padding: 12px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.06);
  color: var(--text);
  font-weight:800;
  font-size:15px;
  text-align:left;
  cursor:pointer;
}
.opt:active{transform: translateY(1px)}
.opt.correct{background: rgba(41,197,107,.20); border-color: rgba(41,197,107,.45)}
.opt.wrong{background: rgba(224,75,75,.20); border-color: rgba(224,75,75,.45)}

/* General toast — top of screen, below topbar */
.toast{
  position:fixed;
  top: calc(70px + env(safe-area-inset-top, 0px));
  left:50%;
  transform: translateX(-50%) translateY(-120%);
  width: calc(100% - 28px);
  max-width: var(--maxw);
  background: rgba(10,20,28,.92);
  border:1px solid rgba(255,255,255,.12);
  border-radius: 16px;
  padding: 10px 14px;
  display:block;
  opacity:0;
  pointer-events:none;
  box-shadow: 0 8px 32px rgba(0,0,0,.45);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  z-index:1000;
  font-weight:700;
  font-size:14px;
  text-align:center;
  transition: none;
}
.toast.show{
  pointer-events:auto;
  opacity:1;
  transform: translateX(-50%) translateY(0);
  animation: toastSlideIn .28s cubic-bezier(.175,.885,.32,1.275);
}
.toast.hiding{
  opacity:0;
  transform: translateX(-50%) translateY(-40%);
  transition: opacity .2s ease, transform .2s ease;
}
@keyframes toastSlideIn{
  from{transform:translateX(-50%) translateY(-120%);opacity:0}
  to{transform:translateX(-50%) translateY(0);opacity:1}
}

/* XP floating text — rises from the XP pill */
.xp-float{
  position:fixed;
  z-index:1001;
  pointer-events:none;
  font-weight:900;
  font-size:18px;
  color:var(--gold);
  text-shadow: 0 0 12px rgba(242,192,76,.6), 0 2px 6px rgba(0,0,0,.5);
  white-space:nowrap;
  animation: xpRise .9s cubic-bezier(.25,.46,.45,.94) forwards;
}
@keyframes xpRise{
  0%{opacity:1;transform:translateY(0) scale(1)}
  50%{opacity:1;transform:translateY(-28px) scale(1.15)}
  100%{opacity:0;transform:translateY(-52px) scale(.9)}
}

/* XP pill pulse glow */
.pill.xp-pulse{
  animation: pillPulse .5s ease;
  box-shadow: 0 0 16px rgba(242,192,76,.5), 0 0 32px rgba(242,192,76,.25);
  border-color: rgba(242,192,76,.5);
  background: rgba(242,192,76,.18);
}
@keyframes pillPulse{
  0%{box-shadow: 0 0 0 rgba(242,192,76,0);transform:scale(1)}
  40%{box-shadow: 0 0 20px rgba(242,192,76,.6), 0 0 40px rgba(242,192,76,.3);transform:scale(1.12)}
  100%{box-shadow: 0 0 16px rgba(242,192,76,.5), 0 0 32px rgba(242,192,76,.25);transform:scale(1)}
}

/* XP sparkle burst (tiny particles) */
@keyframes sparkle{
  0%{opacity:1;transform:translate(0,0) scale(1)}
  100%{opacity:0;transform:translate(var(--sx),var(--sy)) scale(0)}
}
.xp-sparkle{
  position:fixed;z-index:1002;pointer-events:none;
  width:5px;height:5px;border-radius:50%;
  background:var(--gold);
  box-shadow:0 0 4px var(--gold);
  animation: sparkle .5s ease-out forwards;
}

/* Match mode */
.matchGrid{display:grid;grid-template-columns:1fr;gap:10px}
.matchRow{display:grid;grid-template-columns: 1fr 1fr; gap:10px}
.matchCard{
  padding:12px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.06);
  min-height:var(--tap);
  display:flex;
  align-items:center;
  font-weight:800;
  font-size:13px;
  word-break:break-word;
  transition: background .15s ease, border-color .15s ease;
}
.matchCard.pick{outline:2px solid rgba(242,192,76,.55)}
.matchCard.done{background: rgba(41,197,107,.16); border-color: rgba(41,197,107,.45); opacity:.95}
.matchCard.bad{background: rgba(224,75,75,.16); border-color: rgba(224,75,75,.45)}

/* Spot difference */
.split{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:420px){
  .split{grid-template-columns:1fr;gap:8px}
}
.panelMini{padding:10px;border-radius:18px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.05);overflow:hidden}
.panelMini h4{margin:0 0 6px 0;font-size:13px;color:var(--muted);font-weight:700}

/* Bottom nav */
.nav{
  min-height:74px;
  padding:10px 14px calc(12px + env(safe-area-inset-bottom, 0px));
  flex-shrink:0;
  display:flex;
  justify-content:center;
  background: linear-gradient(180deg, rgba(11,31,45,0), rgba(11,31,45,.9) 35%, rgba(11,31,45,.95));
  border-top: 1px solid rgba(255,255,255,.08);
}
.navInner{
  width:100%;max-width:var(--maxw);
  display:flex;
  gap:8px;
}
.navBtn{
  flex:1;
  height:52px;
  border-radius: 18px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.05);
  color: rgba(234,246,255,.85);
  font-weight:800;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  cursor:pointer;
}
.navBtn.active{background: rgba(242,192,76,.16); border-color: rgba(242,192,76,.35); color: var(--text)}

/* Mascot */
.mascot{
  display:flex; gap:12px; align-items:flex-start;
}
.mascot .bubble{
  flex:1;
  padding:12px;
  border-radius: 18px;
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
}
.mascot .fish{
  width:56px;height:56px;border-radius:18px;
  display:grid;place-items:center;
  background: rgba(26,110,165,.18);
  border:1px solid rgba(26,110,165,.28);
  font-size:28px;
}

.kpi{display:flex;gap:10px;flex-wrap:wrap}
.kpi .k{
  flex:1;
  min-width:140px;
  padding:12px;
  border-radius:18px;
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
}
.k .label{font-size:12px;color:var(--muted);font-weight:700}
.k .value{font-size:18px;font-weight:900;margin-top:4px}

/* Fish photo images */
.fish-photo{
  display:block;
  max-width:100%;
  height:auto;
  border-radius:14px;
  box-shadow: 0 4px 16px rgba(0,0,0,.35);
  object-fit:cover;
  margin:0 auto;
}
.fishHero .fish-photo{
  border-radius:16px;
  max-height:220px;
  width:auto;
  max-width:100%;
}
.panelMini .fish-photo{
  border-radius:12px;
  max-height:180px;
  width:100%;
  height:auto;
  object-fit:contain;
  box-shadow: 0 2px 10px rgba(0,0,0,.30);
}

/* Small helper */
hr.sep{border:none;border-top:1px solid rgba(255,255,255,.10);margin:8px 0}
.small{font-size:12px;color:var(--muted)}

/* ===== Transitions & Polish ===== */
.btn{transition: transform .1s ease, background .15s ease, box-shadow .15s ease}
.opt{transition: transform .1s ease, background .15s ease, border-color .15s ease}
.opt:active{transform: translateY(1px) scale(.98)}
.navBtn{transition: background .15s ease, color .15s ease, border-color .15s ease}
.progressBar > div{transition: width .4s cubic-bezier(.25,.46,.45,.94)}
.viewport{scroll-behavior:smooth}

/* Fish name row overflow */
.fishName{flex-wrap:wrap}

/* Text overflow safety */
.list li{word-break:break-word}
.callouts{overflow:hidden}

/* Focus styles (accessibility) */
.btn:focus-visible,.opt:focus-visible,.navBtn:focus-visible,.matchCard:focus-visible{
  outline:2px solid var(--gold);
  outline-offset:2px;
}

/* Fish library card feedback */
#fishLibrary .card{transition: transform .1s ease}
#fishLibrary .card:active{transform: scale(.97)}

/* Lesson card feedback */
.lesson:active{background: rgba(255,255,255,.03)}

/* ===== Responsive: Compact (≤ 380px) ===== */
@media (max-width:380px){
  .brand .sub{display:none}
  .brand h1{font-size:14px}
  .brand .logo{width:32px;height:32px;border-radius:10px}

  .topbar{padding:8px 10px;gap:8px;padding-top:max(8px, env(safe-area-inset-top, 8px))}
  .pill{padding:0 8px;gap:5px;height:36px;font-size:13px}
  .pill .icon{font-size:14px}
  .hud{gap:5px}

  .viewport{padding:10px}
  .card.pad{padding:12px}
  .h2{font-size:18px}

  .navBtn{font-size:12px;gap:3px;height:48px;border-radius:14px}

  .lesson .right{min-width:70px}
  .kpi .k{min-width:0;flex-basis:calc(50% - 5px)}

  .toast{font-size:13px;padding:8px 12px}

  #hudRegen{font-size:8px;padding:1px 5px}
}

/* ===== Responsive: Tiny (≤ 340px) ===== */
@media (max-width:340px){
  .brand .logo{display:none}
  .pill{padding:0 6px;gap:4px;height:34px;font-size:12px}
  .pill .icon{font-size:12px}
  .navBtn{font-size:11px;padding:0 2px}
}
